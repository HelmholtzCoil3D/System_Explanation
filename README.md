# 3D Helmholtz coil system
[TOC]
## Objective of the project

This project aim is to prototype some kind of system control it automaticaly and make some fields setups in static applications.

The idea behind this project is to create a homogeneous field in some defined region where magnetic samples can be tested with a totaly known field

<p align="center">
  <img src="https://i.imgur.com/ytuayWB.png/">
</p>

<p align="center">
  <img src="https://i.imgur.com/5vaQXRf.png">
</p>

<p align="center">
  <img src="https://i.imgur.com/cQSHDOd.png">
</p>

The desired features in this case would be a region with errors bellow 1%, the maximium difference of the magnetic field strenght in two different points and angles with less than 1° of difference between two different points of the homogeneous region. A magnetic flux density range of 1 uT to 1 mT is desired in this region.

The region defined for the prototype at first is a 20 mm³ region

**The system itself just generate the field**, the magnetic sample must have its own system to generate the data for posterior analysis. Analisys can be made based in the known direction and amplitude of the homogeneous region magnetic field.

## Base Knowledge

To create a homogeneous field in some free space region, the concept used was the [Helmholtz coil] that can create a homogeneous field inward from the coils to the geometric center of the estructure, the more in the center, the more homogeneous the field is.

Exitating the coils with a known current generates a known [magnetic field] (H) that is related to the magnetic flux density (B) by the permeability ($\mu$) of the material, in this case the air ([1.00000037])

The B can [saturate] depending on the material, in this case it will not happen so there are no linearity problems

Knowing that the magnetic field will be linear, so a 3 axis Helmholtz coil can be design to generate the arbitrary homogeneous magnetic field, remembering that this system must compensate the [earth magnetic field]

##  Blocks diagram

The system blocks diagram can be represented as follows:

![](https://i.imgur.com/3Lv7iL5.png)

The main parts of the system:
-   Helmholtz coils to generate the field
-   Controller to control the generated field throught magnetic sensors readings
-   Interface to give properly the user commands to the controller

## Helmholtz coils design

#### Simulator

To design the needed helmholtz coils, an open source python library was used, [magpylib], this library is capable to calculate magnetic field of permanent magnets and current lines or circles.

In fact the application is static, so the helmholtz can projected as current loops placed in a helmholtz coil shape.

<p align="center">
  <img src="https://i.imgur.com/Wa3sqmD.png">
</p>

 From the cross-cut section the parameters for the coils calculation can be extracted as the following figure:

<p align="center">
  <img src="https://i.imgur.com/ME0H3qo.png">
</p>

The details about the calculator can be seen in the [Helmholtz coil calculator] file. Giving some parameters to the calculator, it gives us the necessary coil diameter to achieve the desired field in the center of the coil and graphics that shows the field strenght in the 3 vectors of the field separeted (x,y,z) and from this an analysis can be made to determine the homogenity of the field generated by each coil, amplitude and angle error relative to the center in the desired homogeneous region. Following an example for the z axis coil.

Input parameters

``` python
# have to use a little bit bigger value than wireExternalDiameter, if not, the wire will not fit inside
AllCoilsWireDiameter = (0.56 + 0.047)*1.09   # Wire diameter in mm (from dataSheet - https://at.rs-online.com/web/p/kupferdrahte/0357750/)

minRes = 0.06736                            # Ohms/m (from dataSheet)
nominal = 0.06940                           # Ohms/m (from dataSheet)
maxRes = 0.07153                            # Ohms/m (from dataSheet)

wireResistence = maxRes                     # Ohms/m (from dataSheet)

zInitialValueCoilDiameter = 80 # Initial value for the function that calculates the precise diameter

zCoilCurrent = 0.5             # Amperes
zLoopsInEachEvenLayer = 10     # The number of loops in each layer
zEvenLayers = 7                # The evenlayers always have to be equal to oddLayers or oddLayers + 1
zOddLayers = 7
zDesiredField = 1.25           # The desired field in the center of the Helmholtz coil
```
Console results

![](https://i.imgur.com/EVd3a4g.png)

Graphic Results

![](https://i.imgur.com/mBnbwau.png)
![](https://i.imgur.com/lYC8y8B.png)

#### 3D model

With the high precision of the 3D printers ($\pm$ 1 um) the idea was doing the 3 helmholtz coils all together in the same mechanical part, 1 piece. With this, the misalignment problems would desappear, in this way would be interesting the give it a try, doing a 3D printed model to construct the coils.

Misalignment example:
<p align="center">
  <img src="https://i.imgur.com/UBLSEGI.png">
</p>

To design the 3D model the utilized software was [solidWorks], a comercial software for 3D models design, good for geometric models. The design was made based in the simulator results:

##### Simulator results

Wire External Diameter = 0.6 mm (Real Life), 0.66 (Project)

|Coils| Radius | Coil Width| Coil Height|
|:-:|-|-|-|
| Inner | 42.5 mm | 6.6 mm| 9.65 mm |
| Middle | 56.15 mm | 4 mm| 5.5 mm |
| External | 66.5 mm | 4.65 mm| 5.5 mm |

And from those results the 3D model was done in the solidWorks and the result is seen in the following image:

![](https://i.imgur.com/0EmAI26.png)

In the center of the structure, have some holes, they were thought in a way that another 3D model could be done to support the **magnetic sensor** of the system and then above the support for the magnetic sensor another 3D model to support the sample to be tested

#stuff about the 3D models
All the supports are binded with pegs that are printed too


and printed in [Reprap]



#stuff about the 3D models end


![](1https://i.imgur.com/snpOLTE.gif)


#### Practical results

## Magnetic sensor

## Controller

#### Current controller
#### Polaraty controller
#### Sensor controller

### Power Supply

### H-bridges

### MCU


## Interface

## Integration




[Helmholtz coil calculator]:HelmholtzCoilCalculator.md

[magpylib]:https://github.com/magpylib/magpylib

[Helmholtz coil]:https://en.wikipedia.org/wiki/Helmholtz_coil

[magnetic field]:https://en.wikipedia.org/wiki/Magnetic_field

[earth magnetic field]:https://en.wikipedia.org/wiki/Earth%27s_magnetic_field

[1.00000037]:https://en.wikipedia.org/wiki/Permeability_(electromagnetism)

[saturate]:https://en.wikipedia.org/wiki/Saturation_(magnetic)

[coil img 1]:https://i.imgur.com/AkZzpYJ.jpg

[solidWorks]:https://www.solidworks.com/

[Reprap]:https://www.reprap.cc/